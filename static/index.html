<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrgOs - Perception Alignment</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <!-- Registration/Login Page -->
    <div id="auth-page" class="page active">
        <div class="auth-container">
            <div class="logo">
                <h1>ğŸ¯ OrgOs</h1>
                <p>Perception Alignment System</p>
            </div>
            
            <div class="auth-form">
                <h2>Welcome!</h2>
                <p class="subtitle">Enter your name to get started</p>
                
                <input type="text" id="user-name" placeholder="Your Name" autocomplete="name">
                <input type="email" id="user-email" placeholder="Email (optional)" autocomplete="email">
                
                <button onclick="register()" class="primary-btn">Get Started</button>
                
                <div class="divider">or</div>
                
                <p class="small">Already have an account?</p>
                <button onclick="showUserList()" class="secondary-btn">Sign In</button>
            </div>
            
            <!-- User Selection Modal -->
            <div id="user-list-modal" class="modal hidden">
                <div class="modal-content">
                    <h3>Select Your Account</h3>
                    <div id="user-list"></div>
                    <button onclick="hideUserList()" class="secondary-btn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard-page" class="page">
        <div class="header">
            <h2>ğŸ“Š Dashboard</h2>
            <div class="user-info">
                <span id="dashboard-user-name"></span>
                <button onclick="logout()" class="icon-btn">ğŸšª</button>
            </div>
        </div>
        
        <div class="dashboard-container">
            <div class="dashboard-nav">
                <button onclick="showSection('robin')" class="nav-btn active" id="robin-nav">ğŸ¤– Chat with Robin</button>
                <button onclick="showSection('pending')" class="nav-btn" id="pending-nav">ğŸ“‹ Pending Questions</button>
                <button onclick="showSection('graph')" class="nav-btn" id="graph-nav">ğŸ”— Task Graph</button>
                <button onclick="showSection('orgchart')" class="nav-btn" id="orgchart-nav">ğŸ‘¥ Org Chart</button>
                <button onclick="showSection('alignments')" class="nav-btn" id="alignments-nav">Team</button>
                <button onclick="showSection('misalignments')" class="nav-btn" id="misalignments-nav">
                    Misalignments <span id="misalignment-badge" class="badge">0</span>
                </button>
                <button onclick="showSection('ontology')" class="nav-btn" id="ontology-nav">ğŸ“š Schema</button>
            </div>
            
            <!-- Robin Chat Section -->
            <div id="robin-section" class="section active">
                <div class="section-header">
                    <h3>ğŸ¤– Chat with Robin</h3>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="showLastPrompt()" class="secondary-btn" style="font-size: 0.85rem;">ğŸ› View Last Prompt</button>
                        <button onclick="triggerMorningBrief()" class="primary-btn">â˜€ï¸ Morning Brief</button>
                    </div>
                </div>
                
                <div class="robin-chat-container">
                    <div id="robin-messages" class="chat-messages-list">
                        <div class="chat-message system">
                            <div class="message-content">
                                <p>Hi! I'm Robin, your AI assistant. I'm here to help you stay aligned with your team.</p>
                                <p>I can:</p>
                                <ul>
                                    <li>Give you status updates on your tasks</li>
                                    <li>Help you fill in task information</li>
                                    <li>Identify misalignments with your team</li>
                                </ul>
                                <p>Try asking me for a <strong>morning brief</strong> or tell me about your tasks!</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <textarea 
                            id="robin-input" 
                            placeholder="Type your message to Robin..." 
                            rows="2"
                            onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault(); sendMessageToRobin();}"
                        ></textarea>
                        <button onclick="sendMessageToRobin()" class="send-btn" id="robin-send-btn">
                            <span>Send</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Pending Questions Section -->
            <div id="pending-section" class="section">
                <div class="section-header">
                    <h3>ğŸ“‹ Pending Questions for Data Collection</h3>
                    <button onclick="loadPendingQuestions()" class="primary-btn">ğŸ”„ Refresh</button>
                </div>
                <div id="pending-questions-container">
                    <p style="text-align: center; color: #666; padding: 40px;">Loading pending questions...</p>
                </div>
            </div>
            
            <!-- Alignments Section -->
            <div id="alignments-section" class="section">
                <div class="section-header">
                    <h3>ğŸ‘¥ Team Alignments</h3>
                    <p class="subtitle">Select people to compare perceptions with</p>
                </div>
                <div id="alignments-list"></div>
            </div>
            
            <!-- Task Graph Section -->
            <div id="graph-section" class="section">
                <div class="section-header">
                    <h3>ğŸ”— Task Relationship Graph</h3>
                    <p class="subtitle">Visual representation of task dependencies and hierarchies</p>
                </div>
                
                <div class="graph-controls">
                    <div class="filter-group">
                        <label>Owner:</label>
                        <div class="filter-dropdown" id="filter-dropdown-owner">
                            <button class="filter-button" id="filter-btn-owner" onclick="toggleFilterDropdown('owner'); event.stopPropagation();">
                                <span>All</span><span>â–¼</span>
                            </button>
                            <div class="filter-dropdown-content" id="filter-content-owner">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <label>Team:</label>
                        <select id="filter-team" onchange="applyFilters()" class="filter-select">
                            <option value="">All Teams</option>
                            <option value="platform">Platform Team</option>
                            <option value="product">Product Team</option>
                        </select>
                    </div>
                    
                    <div id="attribute-filters" class="attribute-filters">
                        <!-- Dynamic attribute filters will be added here -->
                    </div>
                    
                    <div class="filter-group">
                        <label>Quick Filters:</label>
                        <label><input type="checkbox" id="filter-my-team" onchange="applyFilters()"> ğŸ‘¥ My Team Only</label>
                    </div>
                    
                    <div class="filter-group">
                        <label>Show:</label>
                        <label><input type="checkbox" id="show-parents" checked onchange="applyFilters()"> Parents</label>
                        <label><input type="checkbox" id="show-children" checked onchange="applyFilters()"> Children</label>
                        <label><input type="checkbox" id="show-dependencies" checked onchange="applyFilters()"> Dependencies</label>
                    </div>
                    
                    <div class="filter-group">
                        <label><input type="checkbox" id="show-task-alignment" onchange="renderGraph()"> ğŸ¨ Alignment Colors</label>
                    </div>
                    
                    <div class="filter-actions">
                        <button onclick="clearFilters()" class="secondary-btn">Clear Filters</button>
                        <button onclick="resetGraphView()" class="secondary-btn">ğŸ” Reset View</button>
                        <button onclick="loadTaskGraph()" class="primary-btn">ğŸ”„ Refresh</button>
                    </div>
                </div>
                
                <div class="graph-controls-hint">
                    ğŸ’¡ <strong>Controls:</strong> Scroll to zoom â€¢ Click and drag to pan
                </div>
                
                <div id="graph-container" class="graph-view">
                    <div id="graph-canvas"></div>
                </div>
            </div>
            
            <!-- Misalignments Section -->
            <div id="misalignments-section" class="section">
                <div class="section-header">
                    <h3>âš ï¸ Perception Gaps</h3>
                    <p class="subtitle">Areas where your views differ from your teammates</p>
                </div>
                
                <!-- Team Navigation (for managers only) -->
                <div id="team-navigation" style="display: none;" class="team-navigation">
                    <h4>ğŸ‘¥ View Team Member's Misalignments:</h4>
                    <div id="team-member-buttons" class="team-member-buttons">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                
                <!-- Statistics Dashboard -->
                <div id="misalignment-stats" class="stats-dashboard">
                    <!-- Will be populated dynamically -->
                </div>
                
                <!-- View Toggle -->
                <div class="view-toggle">
                    <button id="stats-view-btn" class="toggle-btn active" onclick="showMisalignmentView('stats')">
                        ğŸ“Š Statistics
                    </button>
                    <button id="list-view-btn" class="toggle-btn" onclick="showMisalignmentView('list')">
                        ğŸ“‹ Detailed List
                    </button>
                </div>
                
                <!-- Charts Section -->
                <div id="misalignment-charts" class="charts-section">
                    <!-- Will be populated dynamically -->
                </div>
                
                <!-- Detailed List -->
                <div id="misalignments-list" style="display: none;">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            
            <!-- Org Chart Section -->
            <div id="orgchart-section" class="section">
                <div class="section-header">
                    <h3>ğŸ‘¥ Organization Chart</h3>
                    <p class="subtitle">Team hierarchy and reporting structure</p>
                </div>
                
                <div class="graph-controls">
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="show-user-alignment" onchange="loadOrgChart()">
                            ğŸ¨ Show Alignment Colors (Green = Aligned, Red = Misaligned)
                        </label>
                    </div>
                    <div class="filter-actions">
                        <button onclick="resetOrgChartView()" class="secondary-btn">ğŸ” Reset View</button>
                        <button onclick="zoomOrgChart(1.2)" class="secondary-btn">â• Zoom In</button>
                        <button onclick="zoomOrgChart(0.8)" class="secondary-btn">â– Zoom Out</button>
                    </div>
                </div>
                
                <div class="graph-controls-hint">
                    ğŸ’¡ <strong>Controls:</strong> Scroll to zoom â€¢ Click and drag to pan â€¢ Double-click to reset
                </div>
                
                <div class="org-chart-container" id="org-chart-container">
                    <svg id="org-chart-svg" width="100%" height="800">
                        <!-- Will be populated dynamically -->
                    </svg>
                </div>
            </div>
            
            <!-- Ontology/Schema Section -->
            <div id="ontology-section" class="section">
                <div class="section-header">
                    <h3>ğŸ“š System Schema</h3>
                    <p class="subtitle">Data model and structure of the OrgOs system</p>
                </div>
                <div id="ontology-content" class="ontology-content">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Task Details Modal -->
    <div id="task-details-modal" class="modal hidden">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3 id="task-details-title"></h3>
                <button onclick="closeTaskDetails()" class="close-btn">âœ•</button>
            </div>
            <div id="task-details-content" class="task-details-content">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>

    <!-- User Misalignment Modal -->
    <div id="user-misalignment-modal" class="modal hidden">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3 id="user-misalignment-title"></h3>
                <button onclick="closeUserMisalignmentModal()" class="close-btn">âœ•</button>
            </div>
            <div id="user-misalignment-content" class="modal-body">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Debug Prompt Modal -->
    <div id="debug-prompt-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 900px; max-height: 80vh; overflow: hidden; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3>ğŸ› Robin's Last Prompt (Debug)</h3>
                <button onclick="closeDebugPrompt()" class="icon-btn">âœ–ï¸</button>
            </div>
            <div id="debug-prompt-content" style="flex: 1; overflow-y: auto; background: #f8f9fa; padding: 16px; border-radius: 8px; font-family: monospace; font-size: 12px; white-space: pre-wrap;"></div>
            <button onclick="closeDebugPrompt()" class="secondary-btn" style="margin-top: 16px;">Close</button>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>

