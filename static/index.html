<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrgOs - Perception Alignment</title>
    <link rel="stylesheet" href="/static/styles.css?v=2024121115">
</head>
<body>
    <!-- Registration/Login Page -->
    <div id="auth-page" class="page active">
        <div class="auth-container">
            <div class="logo">
                <h1>üéØ OrgOs</h1>
                <p>Perception Alignment System</p>
            </div>
            
            <div class="auth-form">
                <h2>Welcome!</h2>
                <p class="subtitle">Enter your name to get started</p>
                
                <input type="text" id="user-name" placeholder="Your Name" autocomplete="name">
                <input type="email" id="user-email" placeholder="Email (optional)" autocomplete="email">
                
                <button onclick="register()" class="primary-btn">Get Started</button>
                
                <div class="divider">or</div>
                
                <p class="small">Already have an account?</p>
                <button onclick="showUserList()" class="secondary-btn">Sign In</button>
            </div>
            
            <!-- User Selection Modal -->
            <div id="user-list-modal" class="modal hidden">
                <div class="modal-content">
                    <h3>Select Your Account</h3>
                    <div id="user-list"></div>
                    <button onclick="hideUserList()" class="secondary-btn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard-page" class="page">
        <div class="header">
            <h2>üìä Dashboard</h2>
            <div class="user-info">
                <span id="dashboard-user-name"></span>
                <button onclick="logout()" class="icon-btn">üö™</button>
            </div>
        </div>
        
        <div class="dashboard-container">
            <div class="dashboard-nav">
                <button onclick="showSection('robin')" class="nav-btn active" id="robin-nav">ü§ñ Chat with Robin</button>
                <button onclick="showSection('pending')" class="nav-btn" id="pending-nav">üìã Pending Questions</button>
                <button onclick="showSection('prompts')" class="nav-btn" id="prompts-nav">‚öôÔ∏è Prompt Editor</button>
                <button onclick="showSection('import-export')" class="nav-btn" id="import-export-nav">üíæ Import/Export</button>
                <button onclick="showSection('graph')" class="nav-btn" id="graph-nav">üîó Task Graph</button>
                <button onclick="showSection('orgchart')" class="nav-btn" id="orgchart-nav">üë• Org Chart</button>
                <button onclick="showSection('misalignments')" class="nav-btn" id="misalignments-nav">
                    Misalignments <span id="misalignment-badge" class="badge">0</span>
                </button>
                <button onclick="showSection('ontology')" class="nav-btn" id="ontology-nav">üìö Schema</button>
                <button onclick="showSection('mcp-tools')" class="nav-btn" id="mcp-tools-nav">üîß MCP Tools</button>
            </div>
            
            <!-- Robin Chat Section -->
            <div id="robin-section" class="section active">
                <div class="section-header">
                    <h3>ü§ñ Chat with Robin</h3>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="triggerMorningBrief()" class="primary-btn">‚òÄÔ∏è Morning Brief</button>
                        <button id="daily-sync-btn" onclick="toggleDailySync()" class="primary-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">üåÖ Start Daily Sync</button>
                    </div>
                    <div style="font-size: 0.85rem; color: #888; margin-top: 8px;">
                        üí° Tip: Click on any Robin message to view debug data (prompt + response)
                    </div>
                </div>
                
                <div class="robin-chat-container">
                    <div id="daily-sync-indicator" style="display: none; padding: 8px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 0.9rem; font-weight: 500; border-radius: 8px; margin-bottom: 12px; text-align: center;">
                        <span id="daily-sync-phase-text">Daily Sync: Greeting</span>
                    </div>
                    <div id="robin-messages" class="chat-messages-list">
                        <div class="chat-message system">
                            <div class="message-content">
                                <p>Hi! I'm Robin, your AI assistant. I'm here to help you stay aligned with your team.</p>
                                <p>I can:</p>
                                <ul>
                                    <li>Give you status updates on your tasks</li>
                                    <li>Help you fill in task information</li>
                                    <li>Identify misalignments with your team</li>
                                </ul>
                                <p>Try asking me for a <strong>morning brief</strong> or tell me about your tasks!</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <textarea 
                            id="robin-input" 
                            placeholder="Type your message to Robin..." 
                            rows="2"
                            onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault(); sendMessageToRobin();}"
                        ></textarea>
                        <button onclick="sendMessageToRobin()" class="send-btn" id="robin-send-btn">
                            <span>Send</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Pending Questions Section -->
            <div id="pending-section" class="section">
                <div class="section-header">
                    <h3>üìã Pending Questions for Data Collection</h3>
                    <button onclick="loadPendingQuestions()" class="primary-btn">üîÑ Refresh</button>
                </div>
                
                <!-- Quick Add Task Form (Expandable) -->
                <div id="quick-add-task-container" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 24px; border: 2px dashed #6366f1;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                        <div style="font-size: 1.1rem; font-weight: 600; color: #4f46e5;">‚ûï Quick Add Task</div>
                        <button onclick="toggleQuickAddExpand()" id="quick-add-expand-btn" 
                                style="padding: 6px 12px; background: #e0e7ff; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem; color: #4f46e5;">
                            üìù Show All Fields
                        </button>
                    </div>
                    
                    <!-- Basic fields (always visible) -->
                    <div style="display: flex; gap: 12px; align-items: center; margin-bottom: 12px;">
                        <input type="text" id="quick-task-name" placeholder="Task name *" 
                               style="flex: 2; padding: 10px 14px; border: 2px solid #e0e7ff; border-radius: 6px; font-size: 0.95rem;">
                        <select id="quick-task-owner" style="flex: 1; padding: 10px 14px; border: 2px solid #e0e7ff; border-radius: 6px; font-size: 0.95rem; background: white;">
                            <option value="">Select owner *</option>
                        </select>
                        <button onclick="quickAddTask()" 
                                style="padding: 10px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; white-space: nowrap;">
                            ‚ûï Add Task
                        </button>
                    </div>
                    
                    <!-- Expanded fields (hidden by default) -->
                    <div id="quick-add-expanded" style="display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px;">
                            <div>
                                <label style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 4px;">Description</label>
                                <textarea id="quick-task-description" placeholder="Task description..." rows="2"
                                          style="width: 100%; padding: 8px 12px; border: 2px solid #e0e7ff; border-radius: 6px; font-size: 0.9rem; resize: vertical;"></textarea>
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 4px;">Parent Task</label>
                                <select id="quick-task-parent" style="width: 100%; padding: 8px 12px; border: 2px solid #e0e7ff; border-radius: 6px; font-size: 0.9rem; background: white;">
                                    <option value="">No parent</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 4px;">Priority</label>
                                <select id="quick-task-priority" style="width: 100%; padding: 8px 12px; border: 2px solid #e0e7ff; border-radius: 6px; font-size: 0.9rem; background: white;">
                                    <option value="">Select priority...</option>
                                    <option value="Critical">Critical</option>
                                    <option value="High">High</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 4px;">Status</label>
                                <select id="quick-task-status" style="width: 100%; padding: 8px 12px; border: 2px solid #e0e7ff; border-radius: 6px; font-size: 0.9rem; background: white;">
                                    <option value="">Select status...</option>
                                    <option value="Not started">Not started</option>
                                    <option value="In progress">In progress</option>
                                    <option value="Blocked">Blocked</option>
                                    <option value="Done">Done</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 4px;">Dependencies (comma-separated task names)</label>
                                <input type="text" id="quick-task-dependencies" placeholder="Task A, Task B..."
                                       style="width: 100%; padding: 8px 12px; border: 2px solid #e0e7ff; border-radius: 6px; font-size: 0.9rem;">
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 4px;">Resources</label>
                                <input type="text" id="quick-task-resources" placeholder="Links, documents..."
                                       style="width: 100%; padding: 8px 12px; border: 2px solid #e0e7ff; border-radius: 6px; font-size: 0.9rem;">
                            </div>
                            <div style="grid-column: span 2;">
                                <label style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 4px;">üë• Relevant Users (who need to align on this task)</label>
                                <select id="quick-task-relevant-users" multiple 
                                        style="width: 100%; padding: 8px 12px; border: 2px solid #e0e7ff; border-radius: 6px; font-size: 0.9rem; min-height: 80px; background: white;">
                                </select>
                                <span style="font-size: 0.75rem; color: #888;">Hold Ctrl/Cmd to select multiple users</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="pending-questions-container">
                    <p style="text-align: center; color: #666; padding: 40px;">Loading pending questions...</p>
                </div>
            </div>
            
            <!-- Prompt Editor Section -->
            <div id="prompts-section" class="section">
                <div class="section-header">
                    <h3>‚öôÔ∏è Robin Prompt Editor</h3>
                    <p class="subtitle">Edit Robin's behavior and context configuration</p>
                </div>
                
                <div class="prompts-container">
                    <div class="prompt-controls-row">
                        <div class="prompt-mode-selector">
                            <label>Mode:</label>
                            <select id="prompt-mode-select" onchange="loadPromptForMode()">
                                <option value="morning_brief">Morning Brief</option>
                                <option value="questions">Questions (Free Chat)</option>
                                <optgroup label="Daily Sync">
                                    <option value="daily_opening">Daily: Opening</option>
                                    <option value="daily_questions">Daily: Questions</option>
                                    <option value="daily_summary">Daily: Summary</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="prompt-version-selector">
                            <label>Version History:</label>
                            <select id="prompt-version-select">
                                <option value="current">Current (Active)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="prompt-editor-container">
                        <div class="prompt-info">
                            <span id="prompt-version-info">Loading prompt data...</span>
                        </div>
                        
                        <div class="prompt-editor-section">
                            <label><strong>System Prompt:</strong></label>
                            <textarea id="prompt-text" rows="20" style="width: 100%; font-family: monospace; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Loading prompt..."></textarea>
                        </div>
                        
                        <div class="prompt-editor-section" style="background: #e8f4e8; padding: 12px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #22c55e;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 20px;">üîß</span>
                                <div>
                                    <strong style="color: #166534;">MCP Tools Architecture</strong>
                                    <p style="margin: 4px 0 0 0; color: #374151; font-size: 13px;">
                                        <b>Context:</b> Fetched dynamically via tools (get_user_context, get_daily_task_context, etc.)<br>
                                        <b>Schema:</b> Enforced by API via text.format<br>
                                        <b>History:</b> Managed by conversation mechanism
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="prompt-editor-section">
                            <label><strong>üí¨ Commit Message (required for saving):</strong></label>
                            <input type="text" id="prompt-notes" placeholder="Describe what you changed in this version..." style="width: 100%; padding: 10px; border: 2px solid #6366f1; border-radius: 4px; font-size: 14px;">
                            <small style="color: #666; display: block; margin-top: 5px;">This will be saved with the version for future reference</small>
                        </div>
                        
                        <div class="prompt-editor-section">
                            <label><strong>üëÅÔ∏è Prompt Preview:</strong></label>
                            <div style="background: #f0f0f0; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                                <small style="color: #666;">This shows the current prompt text. Context is dynamically fetched via MCP tools at runtime.</small>
                            </div>
                            <div id="prompt-preview" style="background: #1e1e1e; color: #d4d4d4; padding: 16px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; white-space: pre-wrap; max-height: 400px; overflow-y: auto; line-height: 1.5;">
                                <span style="color: #888;">Preview will appear here...</span>
                            </div>
                        </div>
                        
                        <div class="prompt-editor-actions">
                            <button onclick="savePrompt()" class="primary-btn">üíæ Save New Version</button>
                            <button onclick="activateSelectedVersion()" class="secondary-btn">‚úÖ Activate Selected Version</button>
                            <button onclick="loadPrompts()" class="secondary-btn">üîÑ Reload</button>
                        </div>
                    </div>
                    
                    <div id="prompt-save-status" style="margin-top: 15px; padding: 10px; border-radius: 4px; display: none;"></div>
                </div>
            </div>
            
            <!-- Import/Export Section -->
            <div id="import-export-section" class="section">
                <div class="section-header">
                    <h3>üíæ Import / Export Data</h3>
                    <p class="subtitle">Backup, restore, or migrate your OrgOs data using Excel files</p>
                </div>
                
                <div class="import-export-container">
                    <!-- Export Section -->
                    <div class="import-export-card">
                        <div class="card-header">
                            <h4>üì§ Export Data</h4>
                            <p>Download all your system data to an Excel file</p>
                        </div>
                        <div class="card-body">
                            <button onclick="exportData()" class="primary-btn" style="width: 100%;">
                                üì• Download Current Data
                            </button>
                            <small style="color: #666; display: block; margin-top: 8px;">
                                Includes: Users, Tasks, Prompts, Answers, Alignments
                            </small>
                        </div>
                    </div>
                    
                    <!-- Template Section -->
                    <div class="import-export-card">
                        <div class="card-header">
                            <h4>üìã Download Template</h4>
                            <p>Get an empty template showing the required format</p>
                        </div>
                        <div class="card-body">
                            <button onclick="exportTemplate()" class="secondary-btn" style="width: 100%;">
                                üìÑ Download Empty Template
                            </button>
                            <small style="color: #666; display: block; margin-top: 8px;">
                                Use this to prepare data for import
                            </small>
                        </div>
                    </div>
                    
                    <!-- Import (Append) Section -->
                    <div class="import-export-card">
                        <div class="card-header">
                            <h4>üì• Import Data (Add)</h4>
                            <p>Add new data from Excel file without deleting existing data</p>
                        </div>
                        <div class="card-body">
                            <input type="file" id="import-file" accept=".xlsx,.numbers" style="display: none;" onchange="handleImportFile(false)">
                            <button onclick="document.getElementById('import-file').click()" class="primary-btn" style="width: 100%;">
                                ‚ûï Select File to Import (Append)
                            </button>
                            <small style="color: #666; display: block; margin-top: 8px;">
                                Safe: Adds new data alongside existing data
                            </small>
                        </div>
                    </div>
                    
                    <!-- Import (Replace) Section -->
                    <div class="import-export-card warning">
                        <div class="card-header">
                            <h4>‚ö†Ô∏è Import Data (Replace)</h4>
                            <p>Replace all users/tasks with data from Excel file</p>
                        </div>
                        <div class="card-body">
                            <input type="file" id="import-replace-file" accept=".xlsx,.numbers" style="display: none;" onchange="handleImportFile(true)">
                            <button onclick="confirmReplace()" class="danger-btn" style="width: 100%;">
                                üóëÔ∏è Select File to Import (Replace)
                            </button>
                            <small style="color: #dc3545; display: block; margin-top: 8px; font-weight: 500;">
                                ‚ö†Ô∏è Warning: Deletes all existing users & tasks!
                            </small>
                            <small style="color: #666; display: block; margin-top: 4px;">
                                Prompts are kept, new prompts are added as latest versions
                            </small>
                        </div>
                    </div>
                </div>
                
                <!-- Status/Result Display -->
                <div id="import-export-status" style="margin-top: 20px; padding: 16px; border-radius: 8px; display: none;">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            
            <!-- Task Graph Section -->
            <div id="graph-section" class="section">
                <div class="section-header">
                    <h3>üîó Task Relationship Graph</h3>
                    <p class="subtitle">Visual representation of task dependencies and hierarchies</p>
                </div>
                
                <div class="graph-controls">
                    <div class="filter-group">
                        <label>Owner:</label>
                        <div class="filter-dropdown" id="filter-dropdown-owner">
                            <button class="filter-button" id="filter-btn-owner" onclick="toggleFilterDropdown('owner'); event.stopPropagation();">
                                <span>All</span><span>‚ñº</span>
                            </button>
                            <div class="filter-dropdown-content" id="filter-content-owner">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <label>Team:</label>
                        <select id="filter-team" onchange="applyFilters()" class="filter-select">
                            <option value="">All Teams</option>
                            <!-- Teams will be populated dynamically from user data -->
                        </select>
                    </div>
                    
                    <div id="attribute-filters" class="attribute-filters">
                        <!-- Dynamic attribute filters will be added here -->
                    </div>
                    
                    <div class="filter-group">
                        <label>Quick Filters:</label>
                        <label><input type="checkbox" id="filter-my-team" onchange="applyFilters()"> üë• My Team Only</label>
                    </div>
                    
                    <div class="filter-group">
                        <label>Show:</label>
                        <label><input type="checkbox" id="show-parents" checked onchange="applyFilters()"> Parents</label>
                        <label><input type="checkbox" id="show-children" checked onchange="applyFilters()"> Children</label>
                        <label><input type="checkbox" id="show-dependencies" checked onchange="applyFilters()"> Dependencies</label>
                    </div>
                    
                    <div class="filter-group">
                        <label><input type="checkbox" id="show-task-alignment" onchange="renderGraph()"> üé® Alignment Colors</label>
                    </div>
                    
                    <div class="filter-actions">
                        <button onclick="clearFilters()" class="secondary-btn">Clear Filters</button>
                        <button onclick="resetGraphView()" class="secondary-btn">üîç Reset View</button>
                        <button onclick="loadTaskGraph()" class="primary-btn">üîÑ Refresh</button>
                    </div>
                </div>
                
                <div class="graph-controls-hint">
                    üí° <strong>Controls:</strong> Scroll to zoom ‚Ä¢ Click and drag to pan
                </div>
                
                <div id="graph-container" class="graph-view">
                    <div id="graph-canvas"></div>
                </div>
            </div>
            
            <!-- Misalignments Section -->
            <div id="misalignments-section" class="section">
                <div class="section-header">
                    <h3>‚ö†Ô∏è Perception Gaps</h3>
                    <p class="subtitle">Areas where your views differ from your teammates</p>
                </div>
                
                <!-- Team Navigation (for managers only) -->
                <div id="team-navigation" style="display: none;" class="team-navigation">
                    <h4>üë• View Team Member's Misalignments:</h4>
                    <div id="team-member-buttons" class="team-member-buttons">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                
                <!-- Statistics Dashboard -->
                <div id="misalignment-stats" class="stats-dashboard">
                    <!-- Will be populated dynamically -->
                </div>
                
                <!-- View Toggle -->
                <div class="view-toggle">
                    <button id="stats-view-btn" class="toggle-btn active" onclick="showMisalignmentView('stats')">
                        üìä Statistics
                    </button>
                    <button id="list-view-btn" class="toggle-btn" onclick="showMisalignmentView('list')">
                        üìã Detailed List
                    </button>
                </div>
                
                <!-- Charts Section -->
                <div id="misalignment-charts" class="charts-section">
                    <!-- Will be populated dynamically -->
                </div>
                
                <!-- Detailed List -->
                <div id="misalignments-list" style="display: none;">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            
            <!-- Org Chart Section -->
            <div id="orgchart-section" class="section">
                <div class="section-header">
                    <h3>üë• Organization Chart</h3>
                    <p class="subtitle">Team hierarchy and reporting structure</p>
                </div>
                
                <div class="graph-controls">
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="show-user-alignment" onchange="loadOrgChart()">
                            üé® Show Alignment Colors (Green = Aligned, Red = Misaligned)
                        </label>
                    </div>
                    <div class="filter-actions">
                        <button onclick="resetOrgChartView()" class="secondary-btn">üîç Reset View</button>
                        <button onclick="zoomOrgChart(1.2)" class="secondary-btn">‚ûï Zoom In</button>
                        <button onclick="zoomOrgChart(0.8)" class="secondary-btn">‚ûñ Zoom Out</button>
                    </div>
                </div>
                
                <div class="graph-controls-hint">
                    üí° <strong>Controls:</strong> Scroll to zoom ‚Ä¢ Click and drag to pan ‚Ä¢ Double-click to reset
                </div>
                
                <div class="org-chart-container" id="org-chart-container">
                    <svg id="org-chart-svg" width="100%" height="800">
                        <!-- Will be populated dynamically -->
                    </svg>
                </div>
            </div>
            
            <!-- Ontology/Schema Section -->
            <div id="ontology-section" class="section">
                <div class="section-header">
                    <h3>üìö System Schema</h3>
                    <p class="subtitle">Data model and structure of the OrgOs system</p>
                </div>
                <div id="ontology-content" class="ontology-content">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            
            <!-- MCP Tools Section -->
            <div id="mcp-tools-section" class="section">
                <div class="section-header">
                    <h3>üîß MCP Tools Debugger</h3>
                    <p class="subtitle">Test Cortex MCP tools and see their responses</p>
                </div>
                
                <div class="mcp-tools-container" style="display: flex; gap: 20px; height: calc(100vh - 200px);">
                    <!-- Left Panel: Tool Selection & Parameters -->
                    <div class="mcp-tools-panel" style="flex: 0 0 350px; background: #f8f9fa; border-radius: 8px; padding: 16px; overflow-y: auto;">
                        <div style="margin-bottom: 16px;">
                            <label style="font-weight: 600; display: block; margin-bottom: 8px;">Select Tool:</label>
                            <select id="mcp-tool-select" onchange="onMcpToolSelect()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                                <option value="">-- Choose a tool --</option>
                            </select>
                        </div>
                        
                        <div id="mcp-tool-description" style="margin-bottom: 16px; padding: 12px; background: #e8f4fd; border-radius: 6px; font-size: 13px; color: #1e3a5f; display: none;">
                        </div>
                        
                        <div id="mcp-tool-params" style="margin-bottom: 16px;">
                            <!-- Parameters will be populated dynamically -->
                        </div>
                        
                        <button onclick="executeMcpTool()" class="primary-btn" style="width: 100%;" id="mcp-execute-btn" disabled>
                            ‚ñ∂Ô∏è Execute Tool
                        </button>
                        
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #ddd;">
                            <label style="font-weight: 600; display: block; margin-bottom: 8px;">Quick Actions:</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <button onclick="quickMcpTool('get_user_context')" class="secondary-btn" style="font-size: 12px; padding: 6px 10px;">User Context</button>
                                <button onclick="quickMcpTool('get_daily_task_context')" class="secondary-btn" style="font-size: 12px; padding: 6px 10px;">Task Context</button>
                                <button onclick="quickMcpTool('get_pending_questions')" class="secondary-btn" style="font-size: 12px; padding: 6px 10px;">Pending Qs</button>
                                <button onclick="quickMcpTool('get_org_structure')" class="secondary-btn" style="font-size: 12px; padding: 6px 10px;">Org Structure</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Panel: Results -->
                    <div class="mcp-tools-results" style="flex: 1; display: flex; flex-direction: column;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h4 style="margin: 0;">üìã Result</h4>
                            <div>
                                <button onclick="copyMcpResult()" class="secondary-btn" style="font-size: 12px; padding: 6px 10px;">üìã Copy</button>
                                <button onclick="clearMcpResult()" class="secondary-btn" style="font-size: 12px; padding: 6px 10px;">üóëÔ∏è Clear</button>
                            </div>
                        </div>
                        <div id="mcp-result" style="flex: 1; background: #1e1e1e; border-radius: 8px; padding: 16px; overflow: auto; font-family: 'Monaco', 'Menlo', 'Consolas', monospace; font-size: 13px; line-height: 1.5;">
                            <span style="color: #888;">Select a tool and click Execute to see results...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Details Modal -->
    <div id="task-details-modal" class="modal hidden">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3 id="task-details-title"></h3>
                <button onclick="closeTaskDetails()" class="close-btn">‚úï</button>
            </div>
            <div id="task-details-content" class="task-details-content">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>

    <!-- User Misalignment Modal -->
    <div id="user-misalignment-modal" class="modal hidden">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3 id="user-misalignment-title"></h3>
                <button onclick="closeUserMisalignmentModal()" class="close-btn">‚úï</button>
            </div>
            <div id="user-misalignment-content" class="modal-body">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Debug Prompt Modal -->
    <div id="debug-prompt-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 900px; max-height: 80vh; overflow: hidden; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3>üêõ Robin's Last Prompt (Debug)</h3>
                <button onclick="closeDebugPrompt()" class="icon-btn">‚úñÔ∏è</button>
            </div>
            <div id="debug-prompt-content" style="flex: 1; overflow-y: auto; background: #f8f9fa; padding: 16px; border-radius: 8px; font-family: monospace; font-size: 12px; white-space: pre-wrap;"></div>
            <button onclick="closeDebugPrompt()" class="secondary-btn" style="margin-top: 16px;">Close</button>
        </div>
    </div>

    <script src="/static/app.js?v=2024121128"></script>
</body>
</html>

